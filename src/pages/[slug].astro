---
import Layout from "../layouts/Layout.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import {
    getPost,
    getPostSlugs,
    decodeHtmlEntities,
    formatDate,
    getAuthorName,
    type WPPost,
} from "../lib/wordpress";

export async function getStaticPaths() {
    try {
        const slugs = await getPostSlugs();
        return slugs.map((slug) => ({
            params: { slug },
        }));
    } catch (error) {
        console.warn("Could not fetch post slugs for static paths");
        return [];
    }
}

const { slug } = Astro.params;

if (!slug) {
    return Astro.redirect("/404");
}

const post = await getPost(slug);

if (!post) {
    return Astro.redirect("/404");
}

const title = decodeHtmlEntities(post.title.rendered);
const author = getAuthorName(post);
const date = new Date(post.date);
const description =
    post.acf?.description || `Read ${title} on It's An Art Party blog`;

// Get author avatar if available
const authorAvatar =
    post._embedded?.author?.[0]?.avatar_urls?.["96"] ||
    "/images/default-avatar.png";
---

<Layout
    title={`${title} | It's An Art Party Blog`}
    description={description}
    image="/images/og-blog.jpg"
>
    <Header showHero={false} />

    <!-- Blog Post Header -->
    <section class="bg-gray-100 py-16 relative overflow-hidden">
        <!-- Decorative Elements -->
        <div class="absolute top-10 left-10 text-white text-4xl opacity-50">
            ★
        </div>
        <div class="absolute bottom-10 right-20 text-white text-2xl opacity-50">
            ★
        </div>
        <div
            class="absolute top-20 right-1/4 w-4 h-4 bg-white rounded-full opacity-50"
        >
        </div>
        <div
            class="absolute bottom-20 left-1/4 w-6 h-6 bg-white rounded-full opacity-30"
        >
        </div>

        <div class="max-w-4xl mx-auto px-4 text-center relative z-10">
            <h1
                class="text-5xl md:text-6xl lg:text-7xl font-display text-brand-teal mb-8 drop-shadow-sm leading-tight"
                itemprop="headline"
            >
                {title}
            </h1>

            <!-- Author Info -->
            <div class="flex flex-col items-center gap-2">
                <img
                    src={authorAvatar}
                    alt={author}
                    class="w-16 h-16 rounded-full border-4 border-white shadow-md object-cover"
                />
                <div class="text-gray-600 text-sm font-body">
                    <span class="text-gray-400">by</span>
                    <span
                        class="text-brand-pink font-semibold"
                        itemprop="author">{author}</span
                    >
                </div>
                <time
                    datetime={date.toISOString()}
                    class="text-gray-400 text-sm font-body"
                    itemprop="datePublished"
                >
                    {formatDate(date.toISOString())}
                </time>
            </div>
        </div>
    </section>

    <!-- Blog Content -->
    <main class="py-12 px-4 md:px-8 max-w-[700px] mx-auto">
        <article
            class="blog-content"
            itemscope
            itemtype="https://schema.org/BlogPosting"
        >
            <meta itemprop="headline" content={title} />
            <meta itemprop="author" content={author} />
            <meta itemprop="datePublished" content={date.toISOString()} />

            <div set:html={post.content.rendered} />
        </article>
    </main>

    <!-- CTA Banner -->
    <section class="bg-brand-pink py-12 px-4">
        <div class="max-w-4xl mx-auto text-center">
            <h2 class="text-3xl md:text-4xl font-display text-white mb-6">
                Ready to Book Your Art Party?
            </h2>
            <a
                href="/contact"
                class="inline-block bg-white text-brand-pink font-bold py-4 px-8 rounded-full text-lg hover:bg-gray-100 transition-colors shadow-lg"
            >
                BOOK NOW! →
            </a>
        </div>
    </section>

    <Footer />
</Layout>

<style is:global>
    /* Blog Content Styling to Match WordPress Theme */
    .blog-content {
        font-family: var(--font-body);
        color: #555;
        font-size: 1rem;
        line-height: 1.8;
    }

    /* Headings - Teal display font, uppercase style */
    .blog-content h2 {
        font-family: var(--font-display);
        color: var(--color-brand-teal);
        font-size: 2rem;
        margin-top: 3rem;
        margin-bottom: 1.5rem;
        text-transform: uppercase;
        letter-spacing: 0.02em;
    }

    .blog-content h3 {
        font-family: var(--font-display);
        color: var(--color-brand-teal);
        font-size: 1.5rem;
        margin-top: 2rem;
        margin-bottom: 1rem;
        text-transform: uppercase;
    }

    .blog-content h4 {
        font-family: var(--font-display);
        color: var(--color-brand-teal);
        font-size: 1.25rem;
        margin-top: 1.5rem;
        margin-bottom: 0.75rem;
    }

    /* Paragraphs */
    .blog-content p {
        margin-bottom: 1.5rem;
        text-align: left;
    }

    /* First paragraph after heading - intro style */
    .blog-content h2 + p,
    .blog-content h1 + p {
        font-size: 1.1rem;
    }

    /* Links */
    .blog-content a {
        color: var(--color-brand-pink);
        text-decoration: none;
        font-weight: 500;
    }

    .blog-content a:hover {
        text-decoration: underline;
    }

    /* Images - Two column float layout */
    .blog-content img {
        max-width: 100%;
        height: auto;
        border-radius: 0.5rem;
        margin: 1.5rem 0;
    }

    /* WordPress alignment classes */
    .blog-content .alignleft,
    .blog-content img.alignleft {
        float: left;
        margin: 0.5rem 2rem 1.5rem 0;
        max-width: 45%;
    }

    .blog-content .alignright,
    .blog-content img.alignright {
        float: right;
        margin: 0.5rem 0 1.5rem 2rem;
        max-width: 45%;
    }

    .blog-content .aligncenter,
    .blog-content img.aligncenter {
        display: block;
        margin: 2rem auto;
        max-width: 80%;
    }

    /* Figure elements (image with caption) */
    .blog-content figure {
        margin: 1.5rem 0;
    }

    .blog-content figure.alignleft {
        float: left;
        margin: 0.5rem 2rem 1.5rem 0;
        max-width: 45%;
    }

    .blog-content figure.alignright {
        float: right;
        margin: 0.5rem 0 1.5rem 2rem;
        max-width: 45%;
    }

    .blog-content figcaption {
        font-size: 0.875rem;
        color: #888;
        text-align: center;
        margin-top: 0.5rem;
    }

    /* Lists */
    .blog-content ul,
    .blog-content ol {
        margin-bottom: 1.5rem;
        padding-left: 1.5rem;
    }

    .blog-content li {
        margin-bottom: 0.5rem;
    }

    /* Blockquotes */
    .blog-content blockquote {
        border-left: 4px solid var(--color-brand-pink);
        padding-left: 1.5rem;
        margin: 2rem 0;
        font-style: italic;
        color: #666;
        background: #fdf2f8;
        padding: 1.5rem;
        border-radius: 0 0.5rem 0.5rem 0;
    }

    /* Clear floats after sections */
    .blog-content h2::before {
        content: "";
        display: table;
        clear: both;
    }

    /* WordPress block styles */
    .blog-content .wp-block-image {
        margin: 1.5rem 0;
    }

    .blog-content .wp-block-image.alignleft {
        float: left;
        margin: 0.5rem 2rem 1.5rem 0;
    }

    .blog-content .wp-block-image.alignright {
        float: right;
        margin: 0.5rem 0 1.5rem 2rem;
    }

    /* Clearfix for floated content */
    .blog-content::after {
        content: "";
        display: table;
        clear: both;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
        .blog-content img.alignleft,
        .blog-content img.alignright,
        .blog-content figure.alignleft,
        .blog-content figure.alignright,
        .blog-content .wp-block-image.alignleft,
        .blog-content .wp-block-image.alignright {
            float: none;
            max-width: 100%;
            margin: 1.5rem auto;
            display: block;
        }

        .blog-content h2 {
            font-size: 1.75rem;
        }

        .blog-content h3 {
            font-size: 1.25rem;
        }
    }
</style>
